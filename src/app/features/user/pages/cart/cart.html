<div
  class="relative overflow-x-auto p-6 min-h-screen transition-colors duration-300"
  [ngClass]="{
    'bg-gray-900': isDarkMode,
    'bg-green-50': !isDarkMode
  }"
>
  <h1
    class="text-3xl font-bold mb-4"
    [ngClass]="{
      'text-gray-100': isDarkMode,
      'text-gray-800': !isDarkMode
    }"
  >
    üõí Cart Page
  </h1>

  <!-- Spinner -->
  <app-spinner [isLoading]="isLoading"></app-spinner>

  <!-- Skeleton -->
  @if (isFirstLoading) {
    <div class="overflow-hidden rounded-xl shadow-lg">
      <table
        class="w-full text-sm text-left"
        [ngClass]="{
          'text-gray-300 bg-gray-800': isDarkMode,
          'text-gray-600 bg-white': !isDarkMode
        }"
      >
        <thead
          class="text-xs uppercase"
          [ngClass]="{
            'bg-green-700 text-gray-100': isDarkMode,
            'bg-green-100 text-green-800': !isDarkMode
          }"
        >
          <tr>
            <th class="px-6 py-3">Image</th>
            <th class="px-6 py-3">Product</th>
            <th class="px-6 py-3">Qty</th>
            <th class="px-6 py-3">Price</th>
            <th class="px-6 py-3 text-center">Action</th>
          </tr>
        </thead>
        <tbody>
          @for (item of [0, 0, 0, 0, 0, 0]; track $index) {
            <tr class="border-b" [ngClass]="{ 'border-gray-700': isDarkMode, 'border-gray-200': !isDarkMode }">
              <td class="px-6 py-4">
                <div
                  class="w-20 h-20 rounded-lg animate-pulse"
                  [ngClass]="{
                    'bg-gray-700': isDarkMode,
                    'bg-gray-300': !isDarkMode
                  }"
                ></div>
              </td>
              <td class="px-6 py-4">
                <div
                  class="h-4 w-32 rounded animate-pulse"
                  [ngClass]="{
                    'bg-gray-600': isDarkMode,
                    'bg-gray-300': !isDarkMode
                  }"
                ></div>
              </td>
              <td class="px-6 py-4">
                <div class="flex items-center space-x-3">
                  <div
                    class="h-6 w-6 rounded-full animate-pulse"
                    [ngClass]="{
                      'bg-gray-600': isDarkMode,
                      'bg-gray-300': !isDarkMode
                    }"
                  ></div>
                  <div
                    class="h-4 w-6 rounded animate-pulse"
                    [ngClass]="{
                      'bg-gray-600': isDarkMode,
                      'bg-gray-300': !isDarkMode
                    }"
                  ></div>
                  <div
                    class="h-6 w-6 rounded-full animate-pulse"
                    [ngClass]="{
                      'bg-gray-600': isDarkMode,
                      'bg-gray-300': !isDarkMode
                    }"
                  ></div>
                </div>
              </td>
              <td class="px-6 py-4">
                <div
                  class="h-4 w-16 rounded animate-pulse"
                  [ngClass]="{
                    'bg-gray-600': isDarkMode,
                    'bg-gray-300': !isDarkMode
                  }"
                ></div>
              </td>
              <td class="px-6 py-4 text-center">
                <div
                  class="h-8 w-20 rounded-lg animate-pulse mx-auto"
                  [ngClass]="{
                    'bg-gray-600': isDarkMode,
                    'bg-gray-300': !isDarkMode
                  }"
                ></div>
              </td>
            </tr>
          }
        </tbody>
      </table>
    </div>
  } @else {
    @if (cartData?.numOfCartItems) {
      <!-- Total Price -->
      <p
        class="font-semibold mb-6 text-lg"
        [ngClass]="{
          'text-green-400': isDarkMode,
          'text-green-600': !isDarkMode
        }"
      >
        Total Price: {{ cartData?.data?.totalCartPrice }} EGP
      </p>

      <!-- Cart Table -->
      <div class="overflow-hidden rounded-xl shadow-lg">
        <table
          class="w-full text-sm text-left"
          [ngClass]="{
            'text-gray-300 bg-gray-800': isDarkMode,
            'text-gray-600 bg-white': !isDarkMode
          }"
        >
          <thead
            class="text-xs uppercase"
            [ngClass]="{
              'bg-green-700 text-gray-100': isDarkMode,
              'bg-green-100 text-green-800': !isDarkMode
            }"
          >
            <tr>
              <th scope="col" class="px-6 py-3">Image</th>
              <th scope="col" class="px-6 py-3">Product</th>
              <th scope="col" class="px-6 py-3">Qty</th>
              <th scope="col" class="px-6 py-3">Price</th>
              <th scope="col" class="px-6 py-3 text-center">Action</th>
            </tr>
          </thead>
          <tbody>
            @for (item of cartData?.data?.products; track $index) {
              <tr
                class="border-b transition"
                [ngClass]="{
                  'border-gray-700 hover:bg-gray-700': isDarkMode,
                  'border-gray-200 hover:bg-gray-50': !isDarkMode
                }"
              >
                <!-- Image -->
                <td class="px-6 py-4">
                  <img
                    [src]="item.product.imageCover"
                    [alt]="item.product.title"
                    class="w-20 h-20 object-cover rounded-lg shadow-sm"
                  />
                </td>

                <!-- Title -->
                <td
                  class="px-6 py-4 font-medium"
                  [ngClass]="{
                    'text-gray-100': isDarkMode,
                    'text-gray-900': !isDarkMode
                  }"
                >
                  {{ item.product.title }}
                </td>

                <!-- Quantity -->
                <td class="px-6 py-4">
                  <div class="flex items-center space-x-3">
                    <button
                      (click)="updateCount(item.product._id, item.count - 1)"
                      class="h-7 w-7 flex items-center justify-center rounded-full transition"
                      [ngClass]="{
                        'bg-gray-600 text-gray-300 hover:bg-gray-500': isDarkMode,
                        'bg-gray-200 text-gray-700 hover:bg-gray-300': !isDarkMode
                      }"
                      type="button"
                    >
                      <i class="fa fa-minus text-xs"></i>
                    </button>
                    <span
                      class="font-semibold"
                      [ngClass]="{
                        'text-gray-100': isDarkMode,
                        'text-gray-800': !isDarkMode
                      }"
                    >
                      {{ item.count }}
                    </span>
                    <button
                      (click)="updateCount(item.product._id, item.count + 1)"
                      class="h-7 w-7 flex items-center justify-center rounded-full transition"
                      [ngClass]="{
                        'bg-green-600 text-white hover:bg-green-700': isDarkMode,
                        'bg-green-500 text-white hover:bg-green-600': !isDarkMode
                      }"
                      type="button"
                    >
                      <i class="fa fa-plus text-xs"></i>
                    </button>
                  </div>
                </td>

                <!-- Price -->
                <td
                  class="px-6 py-4 font-semibold"
                  [ngClass]="{
                    'text-gray-100': isDarkMode,
                    'text-gray-900': !isDarkMode
                  }"
                >
                  {{ item.price }} EGP
                </td>

                <!-- Remove Button -->
                <td class="px-6 py-4 text-center">
                  <button
                    (click)="deleteProduct(item.product._id)"
                    class="px-3 py-1 bg-red-500 hover:bg-red-600 text-white text-sm font-medium rounded-lg shadow-md transition"
                  >
                    Remove
                  </button>
                </td>
              </tr>
            }
          </tbody>
        </table>
      </div>

      <!-- Actions -->
      <div class="flex justify-between items-center mt-6">
        <button
          (click)="clearCart()"
          type="button"
          class="px-5 py-2 bg-red-500 hover:bg-red-600 text-white font-semibold rounded-lg shadow-md transition"
        >
          Clear Cart
        </button>

        <button
          (click)="checkOutSession()"
          type="button"
          class="px-5 py-2 font-semibold rounded-lg shadow-md transition"
          [ngClass]="{
            'bg-green-600 hover:bg-green-700 text-white': isDarkMode,
            'bg-green-500 hover:bg-green-600 text-white': !isDarkMode
          }"
        >
          CheckOut
        </button>
      </div>
    } @else {
      <div
        class="text-center py-12"
        [ngClass]="{
          'text-red-400': isDarkMode,
          'text-red-500': !isDarkMode
        }"
      >
        <p class="text-lg font-semibold">No Items in Cart üõçÔ∏è</p>
      </div>
    }
  }
</div>